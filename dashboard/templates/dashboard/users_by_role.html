// {% extends 'dashboard/base_dashboard.html' %}

{% comment %}
  -------------------------------------------------------------------
  File: users_by_role.html
  Role: Admin
  Purpose: Display users filtered by role with action links for each user
  -------------------------------------------------------------------
{% endcomment %}

{% block content %}

<div class="max-w-5xl mx-auto px-4 space-y-6">
  <h2 class="text-2xl font-semibold text-white mb-4 text-center">
    All {{ label }}
  </h2>
  {% include 'dashboard/components/message_alert.html' with alert_class="bg-green-600 text-white border-indigo-200 shadow-lg" %}

  <!-- Email Search Form (Admin Only) -->
  {% if request.user.role == 'admin' %}
  <div class="mb-6 flex justify-end">
    <form method="get" class="flex items-center space-x-2">
      <input type="text" id="search_email" name="search_email" value="{{ search_query }}" 
             class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
             placeholder="Username or Email">
      <button type="submit" class="bg-blue-600 text-black px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200 hover:text-white">
        Search
      </button>
      {% if search_query %}
      <a href="{% url 'dashboard:view_users_by_role' role %}" class="text-gray-black bg-blue-600 px-4 py-2 rounded-lg hover:text-white hover:bg-blue-700">Clear</a>
      {% endif %}
    </form>
  </div>
  {% endif %}

  <table class="min-w-full bg-white border border-gray-200 rounded-md shadow-sm">
    <thead class="bg-gray-100 text-gray-700 text-sm">
      <tr>
        <th class="px-4 py-2 text-center">Username</th>
        <th class="px-4 py-2 text-center">Email</th>
        {% if role != 'admin' %}
          <th class="px-4 py-2 text-center">Actions</th>
        {% endif %}
      </tr>
    </thead>
    <tbody class="text-sm divide-y divide-gray-200 text-center">
      {% for user in users %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-2 font-medium text-gray-800">{{ user.username }}</td>
          <td class="px-4 py-2 text-gray-600">{{ user.email }}</td>
          {% if role != 'admin' %}
            <td class="px-4 py-2 space-x-2">
              <a href="{% url 'dashboard:edit_user' user.id %}" class="text-indigo-600 hover:underline">âœï¸ Edit</a>
              <a href="{% url 'dashboard:update_role' user.id %}" class="text-blue-600 hover:underline btn btn-primary">ğŸ”„ Update Role</a>
              <a href="{% url 'dashboard:delete_user' user.id %}" class="text-red-600 hover:underline">ğŸ—‘ï¸ Delete</a>
              <a href="{% url 'users:admin_change_user_password' user.id %}" class="text-black hover:underline">Change Password</a>
            </td>
          {% endif %}
        </tr>
      {% empty %}
        <tr>
          <td colspan="{% if role != 'admin' %}3{% else %}2{% endif %}" class="px-4 py-8 italic text-center text-gray-500">
            No users found
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
